**Проект для автоматизации DevOps процессов**
=====================

**Описание**
------------

Этот проект представляет собой набор инструментов и скриптов для автоматизации процессов разработки, тестирования и развертывания приложений. <br>
Проект использует современные технологии и методологии DevOps для обеспечения высокого уровня качества и производительности.

### Структура проекта

* `docker-compose.yaml`: файл конфигурации для Docker Compose, который определяет сервисы и их зависимости.
* `Dockerfile`: файл конфигурации для сборки Docker-образа, который определяет инструкции для сборки образа.
* `devops`: каталог с инструментами и скриптами для DevOps, который содержит скрипты для автоматизации процессов развертывания и конфигурации.
* `README.md`: файл с документацией проекта, который содержит информацию о проекте, его структуре и требованиях.

### Сервисы

* **Django**: основной сервис приложения. http://89.169.137.242:30080
* **Мониторинг**: мониторинг сервисов приложения. 
* **Grafana**: мониторинг сервисов приложения. http://89.169.139.230:3000 Settings http url http://localhost:9090
* Доступы к `grafana` login: admin password: admin
* **Prometheus**: мониторинг сервисов приложения. http://89.169.139.230:9090
* **Alertmanager**: мониторинг сервисов приложения. http://89.169.139.230:9093
* **Node exporter**: мониторинг сервисов приложения. http://89.169.139.230:9100
* **Blackbox exporter**: мониторинг сервисов приложения. http://89.169.139.230:9115

Сборка проекта проиизводится в репозитории (https://gitlab.com/SerJCol/django-app)
* **django-app**: Helm chart копируемый с репозитория и устанавливаемый на master node через Ansible.
* **django-pg-docker**: Посредством Docker compose производится сборка приложения с отправкой в docker hub.
* Установка на worker node через Ansible.

### Инструменты и скрипты

* `docker-compose`: инструмент для управления контейнерами Docker, который позволяет запускать и останавливать контейнеры, а также управлять их зависимостями.
* `docker`: инструмент для управления Docker-образами, который позволяет создавать, запускать и останавливать образы.
* `ansible`: инструмент для автоматизации процессов развертывания и конфигурации, который позволяет создавать и управлять конфигурациями серверов и приложений.
* `gitlab`: инструмент для управления версиями кода и автоматизации процессов сборки и тестирования.
* `terraform`: инструмент для управления инфраструктурой, который позволяет создавать и управлять ресурсами облачных провайдеров.
* `grafana`: инструмент для визуализации и мониторинга метрик и метрик приложений.
* `prometheus`: инструмент для визуализации и мониторинга метрик и метрик приложений.
* `node_exporter`: инструмент для визуализации и мониторинга метрик и метрик приложений.
* `blackbox_exporter`: инструмент для визуализации и мониторинга метрик и метрик приложений.
* `alertmanager`: инструмент для визуализации и мониторинга метрик и метрик приложений.
* `fluentd`: инструмент для визуализации и мониторинга метрик и метрик приложений.

### Процессы
* **Тестирование приложения**: процесс тестирования приложения с помощью GitLab CI/CD.
* **Сборка и публикация Docker-образа**: процесс сборки Docker-образа с помощью Dockerfile и docker-compose.yml и публикации его в Docker Hub.
* **Развертывание приложения на сервере**: процесс развертывания приложения на сервере с помощью Ansible.
* **Мониторинг и логирование**: процесс мониторинга и логирования приложения с помощью различных инструментов.

### Автоматизация
* **Тестирование приложения**: процесс тестирования приложения с помощью GitLab CI/CD.
* **Сборка и публикация Docker-образа**: процесс сборки Docker-образа с помощью Dockerfile и docker-compose.yml и публикации его в Docker Hub.
* **Развертывание приложения на сервере**: процесс развертывания приложения на сервере с помощью Ansible.

### Требования

* Docker
* Docker Compose
* Ansible
* GitLab
* Git
* Terraform
* Grafana
* Prometheus
* Alertmanager
* Blackbox exporter
* Node exporter
* Fluentd

### Установка

1. Установить [Terraform](https://www.terraform.io/) на свой компьютер, следуя инструкциям на сайте.
Клонировать пример Терраформа можно по следующей ссылке git clone https://github.com/SerJCoL/devops.git
Notes:
Создайте файл `terraform.tfvars` со следующими переменными в переменных укажите свои значения:
   ```hcl
   yandex_token = "YOUR_YANDEX_TOKEN"
   cloud_id     = "YOUR_CLOUD_ID"
   folder_id    = "YOUR_FOLDER_ID"
   ```
Выполните команду `terraform apply -var-file=terraform.tfvars -auto-approve` 
2. Ручные действия: Скопировать в host.txt в папку k8s ip-адреса сервера.
3. Установите Ansible на свой компьютер, следуя инструкциям на сайте Ansible.
4. Клонировать пример Ansible задачи можно по следующей ссылке git clone https://gitlab.com/SerJCol/django-app.git
5. При помощи CI/CD pipeline копировать Dockerfile на DockerHub
6. Далее идет установка через Ansible необходимых компонентов при помощи команды `ansible-playbook -i ../Ansible_k8s_monitoring/hosts.txt ../Ansible_k8s_monitoring/playbook.yml -K`
7. Установка `docker-compose` и `docker`.
8. Установка `kubectl` и `helm`.
9. Создание кластера k8s.
10. Копирование токена на worker-узлы.
11. Присваивание роли worker.
12. Установка библиотеки `kubernetes` для работы на master-узле. 
13. Копирование helm-charts bp DockerHub на master-узел.
14. Установка helm-charts на master-узле.
15. Установка `monitoring` на srv-узле в котором будет `alertmanager`, `grafana`, `prometheus` `node_exporter`, `blackbox_exporter` и `fluentd`.
16. В данном проекте используется официальные репозитории GitHub, GitLab и DockerHub.

